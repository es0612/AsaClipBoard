# 要件定義書

## 概要

SwiftUIを使用してmacOS用のクリップボード管理ツールを開発します。このアプリは、ユーザーがコピーしたテキストや画像を履歴として保存し、プレビュー機能付きで簡単にアクセス・再利用できるようにします。App Storeでの配布を前提とし、既存のクリップボード管理ツールとの差別化を図る独自機能も含みます。

## 要件

### 要件1

**ユーザーストーリー:** Macユーザーとして、コピーしたテキストや画像を自動的に履歴に保存したい。新しいアイテムをコピーした後でも、以前にコピーしたコンテンツにアクセスできるようにするため。

#### 受け入れ基準

1. ユーザーがテキストまたは画像コンテンツをコピーした時、システムはコンテンツをクリップボード履歴に自動保存する
2. クリップボード履歴が最大制限に達した時、システムは制限を維持するために最も古いエントリを削除する
3. システムが起動した時、システムは永続化ストレージから以前に保存されたクリップボード履歴を読み込む
4. コピーされたコンテンツが最新のエントリと同一の場合、システムは重複エントリを作成しない

### 要件2

**ユーザーストーリー:** ユーザーとして、クリップボード履歴アイテムのプレビューを見たい。必要なコンテンツを素早く識別して選択できるようにするため。

#### 受け入れ基準

1. テキストコンテンツを表示する時、システムはテキストの最初の数行を含む短縮プレビューを表示する
2. 画像コンテンツを表示する時、システムは画像のサムネイルプレビューを表示する
3. リッチコンテンツ（HTML、RTF）を表示する時、システムはフォーマット済みプレビューとプレーンテキスト版の両方を表示する
4. プレビューが長すぎる時、システムはそれを短縮し、より多くのコンテンツがあることを示す

### 要件3

**ユーザーストーリー:** ユーザーとして、グローバルホットキーを通じてクリップボード履歴に素早くアクセスしたい。ワークフローを中断することなくコンテンツを取得できるようにするため。

#### 受け入れ基準

1. ユーザーが設定されたグローバルホットキーを押した時、システムはクリップボード履歴ウィンドウを表示する
2. クリップボード履歴ウィンドウが開いている時、システムはキーボードの矢印キーを使用したナビゲーションを許可する
3. ユーザーがアイテムを選択した時、システムはそれをクリップボードにコピーしてウィンドウを閉じる
4. ユーザーがEscapeキーを押した時、システムは変更を加えることなくクリップボード履歴ウィンドウを閉じる

### 要件4

**ユーザーストーリー:** ユーザーとして、クリップボードアイテムをカテゴリとお気に入りで整理したい。頻繁に使用するコンテンツをより良く管理できるようにするため。

#### 受け入れ基準

1. ユーザーがクリップボードアイテムを右クリックした時、システムはお気に入りに追加またはカテゴリを割り当てるオプションを表示する
2. クリップボード履歴を表示する時、システムはカテゴリとお気に入りによるフィルタリングを許可する
3. アイテムがお気に入りとしてマークされた時、システムは履歴制限による自動削除からそれを保護する
4. アイテムを表示する時、システムはお気に入りとカテゴリの視覚的インジケーターを表示する

### 要件5

**ユーザーストーリー:** ユーザーとして、スマートコンテンツ認識とアクションを利用したい。コピーされたコンテンツの種類に応じて関連するアクションを実行できるようにするため。

#### 受け入れ基準

1. コピーされたコンテンツにURLが含まれている時、システムはブラウザでURLを開くオプションを提供する
2. コピーされたコンテンツにメールアドレスが含まれている時、システムはメールを作成するオプションを提供する
3. コピーされたコンテンツに電話番号が含まれている時、システムは通話またはメッセージのオプションを提供する
4. コピーされたコンテンツにカラーコード（hex、rgb）が含まれている時、システムはカラープレビューを表示する
5. コピーされたコンテンツにコードが含まれている時、システムはプログラミング言語を検出してシンタックスハイライトを提供する

### 要件6

**ユーザーストーリー:** ユーザーとして、Macデバイス間でクリップボード履歴を同期したい。どのデバイスからでもクリップボードコンテンツにアクセスできるようにするため。

#### 受け入れ基準

1. ユーザーがiCloud同期を有効にした時、システムはクリップボード履歴をiCloudにアップロードする
2. 一つのデバイスでクリップボード履歴が更新された時、システムは30秒以内に他のデバイスに変更を同期する
3. 同期競合が発生した時、システムはタイムスタンプによって履歴をマージする
4. iCloudが利用できない場合、システムはオフラインで動作を継続し、接続が復旧した時に同期する

### 要件7

**ユーザーストーリー:** ユーザーとして、アプリの外観と動作をカスタマイズしたい。個人のワークフローと好みに合わせられるようにするため。

#### 受け入れ基準

1. 設定にアクセスする時、システムはグローバルホットキーのカスタマイズを許可する
2. 設定にアクセスする時、システムは最大履歴サイズの設定（10-1000アイテム）を許可する
3. 設定にアクセスする時、システムはライト、ダーク、システム外観の選択を許可する
4. 設定にアクセスする時、システムは自動起動の有効/無効の設定を許可する
5. 設定にアクセスする時、システムは追跡するコンテンツタイプ（テキスト、画像、ファイル）の設定を許可する

### 要件8

**ユーザーストーリー:** ユーザーとして、アプリが安全でプライバシーを尊重することを望む。機密性の高いクリップボードコンテンツが保護されるようにするため。

#### 受け入れ基準

1. アプリがパスワードのようなコンテンツを検出した時、システムは履歴から除外するオプションを提供する
2. ユーザーがプライベートモードを有効にした時、システムは一時的にクリップボード履歴の記録を停止する
3. クリップボードデータを保存する時、システムはmacOS Keychainを使用して機密コンテンツを暗号化する
4. アプリが設定された時間使用されていない時、システムは自動的にクリップボード履歴へのアクセスをロックする
5. ユーザーがアクセシビリティ権限を付与していない場合、システムはそれを有効にするための明確な指示を表示する

### 要件9

**ユーザーストーリー:** 開発者/パワーユーザーとして、高度な検索とフィルタリング機能を利用したい。広範なクリップボード履歴から特定のコンテンツを素早く見つけられるようにするため。

#### 受け入れ基準

1. ユーザーが検索フィールドに入力する時、システムはコンテンツに基づいてリアルタイムでアイテムをフィルタリングする
2. 検索する時、システムは上級ユーザー向けに正規表現パターンをサポートする
3. 検索する時、システムは日付範囲、コンテンツタイプ、サイズによるフィルタリングを許可する
4. 検索結果が表示される時、システムはプレビューで一致するテキストをハイライトする
5. 検索結果が見つからない時、システムは役立つ提案を表示する

### 要件10

**ユーザーストーリー:** Macユーザーとして、アプリがmacOSとシームレスに統合されることを望む。システムのネイティブな部分のように感じられるようにするため。

#### 受け入れ基準

1. アプリが実行されている時、システムは現在のステータスを示すメニューバーアイコンを表示する
2. メニューバーアイコンをクリックした時、システムは最近のアイテムのクイックプレビューを表示する
3. アプリが起動した時、システムはmacOSのアクセシビリティとプライバシー設定を尊重する
4. 通知を表示する時、システムはネイティブmacOS通知システムを使用する
5. アプリが更新される時、システムはmacOSネイティブ更新メカニズムを使用する